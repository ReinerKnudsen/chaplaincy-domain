import{h as i,f as u,d,b as h,s as U,c as f}from"./firebaseConfig.hXLAg77p.js";import{u as p,a as n}from"./AuthStore.DLq-_aif.js";import{s as m,a as y,c as E,u as P}from"./index-219c3cac.UombHsWy.js";const C=i(u,"listUsers"),b=async()=>{try{return(await C()).data.users}catch(s){console.error("Error listing users:",s)}};async function D(s){try{return await i(u,"getUserProfile")({uid:s}).then(r=>r.data.user).catch(r=>{throw console.log(r.message),r})}catch(e){throw console.log("Error: ",e.message),e}}async function I(s){return s.getIdTokenResult().then(e=>e.claims.role)}async function B({email:s,displayName:e,role:r,firstname:a,lastname:l}){console.log("Parameters: ",s,e,r,a,l);try{const t=await i(u,"createUser")({email:s,displayName:e,role:r}),o=t.data.uid;console.log(t),console.log("Create user profile in Firestore: ",d,o);try{const g=h(d,"users",o);await U(g,{firstname:a,lastname:l,email:s,displayName:e},{merge:!0})}catch(g){console.log("Error: ",g)}const w={url:"https://chaplaincy-website.netlify.app/passwordreset",handleCodeInApp:!0};return await m(f,t.data.email,w),t}catch(c){console.log("Couldn't create user ",c)}}async function x(s,e){await p();try{n.update(c=>({...c,loading:!0,error:null}));const a=(await y(f,s,e)).user,l=await I(a);return n.set({...n,user:a,name:a.displayName,loading:!1,error:null,isLoggedIn:!0,role:l}),a}catch(r){n.update(a=>({...a,loading:!1,error:r.message,isLoggedIn:!1})),console.log("Error: ",r.message)}}async function F({email:s,displayName:e,firstname:r,lastname:a,role:l},c){try{n.update(o=>({...o,loading:!0,error:null}));let t;c&&(t=(await E(f,s,c)).user,await P(t,{displayName:e}),l&&await setUserRole(t.uid,l));try{const o=h(d,"users",t.uid);await U(o,{firstname:r,lastname:a,email:s,displayName:e},{merge:!0})}catch(o){console.log("Error: ",o.message)}return n.set({...n,user:t,name:t.displayName,role:"user",loading:!1,error:null,isLoggedIn:!0}),t}catch(t){throw console.log("Error: ",t.code),n.update(o=>({...o,loading:!1,error:t.message,isLoggedIn:!1})),t}}async function W(s){try{return await i(u,"updateUserProfile")(s).then(r=>r).catch(r=>{throw console.log(r.message),r})}catch(e){throw console.log("Error: ",e.message),e}}export{I as a,B as c,D as g,b as l,F as r,x as s,W as u};
