import{h as u,f as i,d,b as f,s as U,c as h}from"./firebaseConfig.hXLAg77p.js";import{u as m,a as n}from"./AuthStore.42czV-rK.js";import{s as p,a as y,c as R,u as E}from"./index-219c3cac.UombHsWy.js";async function P(r,e){u(i,"setUserRole")({uid:r,role:e}).then(t=>{console.log("After role assignment: ",t)}).catch(t=>{console.log(t.message)})}const A=u(i,"listUsers"),D=async()=>{try{return(await A()).data.users}catch(r){console.error("Error listing users:",r)}};async function B(r,e){u(i,"addUserRole")({email:r,role:e}).then(t=>{console.log("After role assignment: ",t)}).catch(t=>{console.log("Error: ",t.message)})}async function x(r){try{return await u(i,"getUserProfile")({uid:r}).then(s=>s.data.user).catch(s=>{throw console.log(s.message),s})}catch(e){throw console.log("Error: ",e.message),e}}async function C(r){return r.getIdTokenResult().then(e=>e.claims.role)}async function F({email:r,displayName:e,role:s,firstname:t,lastname:l}){console.log("Parameters: ",r,e,s,t,l);try{const o=await u(i,"createUser")({email:r,displayName:e,role:s}),a=o.data.uid;console.log(o),console.log("Create user profile in Firestore: ",d,a);try{const g=f(d,"users",a);await U(g,{firstname:t,lastname:l,email:r,displayName:e},{merge:!0})}catch(g){console.log("Error: ",g)}const w={url:"http://localhost:5173/passwordreset",handleCodeInApp:!0};return await p(h,o.data.email,w),o}catch(c){console.log("Couldn't create user ",c)}}async function W(r,e){await m();try{n.update(c=>({...c,loading:!0,error:null}));const t=(await y(h,r,e)).user,l=await C(t);return n.set({...n,user:t,name:t.displayName,loading:!1,error:null,isLoggedIn:!0,role:l}),t}catch(s){n.update(t=>({...t,loading:!1,error:s.message,isLoggedIn:!1})),console.log("Error: ",s.message)}}async function _({email:r,displayName:e,firstname:s,lastname:t,role:l},c){try{n.update(a=>({...a,loading:!0,error:null}));let o;c&&(o=(await R(h,r,c)).user,await E(o,{displayName:e}),l&&await P(o.uid,l));try{const a=f(d,"users",o.uid);await U(a,{firstname:s,lastname:t,email:r,displayName:e},{merge:!0})}catch(a){console.log("Error: ",a.message)}return n.set({...n,user:o,name:o.displayName,role:"user",loading:!1,error:null,isLoggedIn:!0}),o}catch(o){throw console.log("Error: ",o.code),n.update(a=>({...a,loading:!1,error:o.message,isLoggedIn:!1})),o}}async function k(r){try{return await u(i,"updateUserProfile")(r).then(s=>s).catch(s=>{throw console.log(s.message),s})}catch(e){throw console.log("Error: ",e.message),e}}export{B as a,C as b,F as c,x as g,D as l,_ as r,W as s,k as u};
